# ì¼ê³±ë²ˆì§¸ í”„ë¡œì íŠ¸ - ì€í–‰ ì°½êµ¬ ë§¤ë‹ˆì €

## í”„ë¡œì íŠ¸ ì •ë³´
- ğŸ—“ ê¸°ê°„ : 2021/01/04 ~ 2021/01/17(2w)

- ğŸ“ ì„¤ëª… : ì€í–‰ì„ ê°œì í•˜ë©´ 10~30ëª…ì˜ ê³ ê°ì´ ë°©ë¬¸í•œë‹¤! ê³ ê° ë“±ê¸‰ê³¼ ì—…ë¬´ì— ë”°ë¼ ì€í–‰ì›ê³¼ ë³¸ì‚¬ê°€ ì¬ë¹ ë¥´ê²Œ ì¼ì²˜ë¦¬ë¥¼ í•˜ëŠ” ì½˜ì†”ì•± ğŸ¦

- ğŸ—‚ ì„¸ë¶€ì‚¬í•­
  - 

- <img width="250" src="https://user-images.githubusercontent.com/49546979/117671143-72ffee80-b1e3-11eb-981f-8863778b72bf.gif">

## í”„ë¡œì íŠ¸ êµ¬ì¡°

![UML](https://user-images.githubusercontent.com/49546979/117694761-78b4fe80-b1fa-11eb-9479-52eda923c2b6.png)


## í”„ë¡œì íŠ¸ ì´ìŠˆ

[1. ì–´ë–»ê²Œí•˜ë©´ ì€í–‰ì› 3ëª…ì´ ë™ì‹œì— ì—…ë¬´ë¥¼ ë³¼ìˆ˜ìˆì„ê¹Œ](#ì–´ë–»ê²Œí•˜ë©´-ì€í–‰ì›-3ëª…ì´-ë™ì‹œì—-ì—…ë¬´ë¥¼-ë³¼ìˆ˜ìˆì„ê¹Œ)  
[2. ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ í•˜ê¸°ìœ„í•´ ë¬´ì—‡ì„ ì‚¬ìš©í•´ì•¼í• ê¹Œ](#ë¹„ë™ê¸°-í”„ë¡œê·¸ë˜ë°ì„-í•˜ê¸°ìœ„í•´-ë¬´ì—‡ì„-ì‚¬ìš©í•´ì•¼í• ê¹Œ)  
[3. ì–´ë–¤ queueë¥¼ ì‚¬ìš©í• ê¹Œ](#ì–´ë–¤-queueë¥¼-ì‚¬ìš©í• ê¹Œ)  

### ì–´ë–»ê²Œí•˜ë©´ ì€í–‰ì› 3ëª…ì´ ë™ì‹œì— ì—…ë¬´ë¥¼ ë³¼ìˆ˜ìˆì„ê¹Œ

ì²˜ìŒì—ëŠ” ì€í–‰ì› 1ëª…ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë•ŒëŠ” ì€í–‰ì›ì´ 1ëª…ì´ê³ , ê³ ê°ì„ 1ëª…ì”© ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´ ë˜ì—ˆê¸° ë•Œë¬¸ì— í° ë¬¸ì œê°€ ì—†ì—ˆìŠµë‹ˆë‹¤.  
ê·¸ëŸ°ë° ì€í–‰ì›ì´ 3ëª…ì´ ë˜ë©´ì„œ ê°ê°ì˜ ì€í–‰ì›ë“¤ì´ ìì‹ ì˜ ì—…ë¬´ë¥¼ ë³´ì•„ì•¼í•˜ëŠ” ìƒí™© ë‹¤ì‹œë§í•´, `3ëª…ì´ ë™ì‹œì— ì—…ë¬´ë¥¼ ì²˜ë¦¬í•´ì•¼í•˜ëŠ” ìƒí™©`ì´ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.  
í•˜ì§€ë§Œ **ê¸°ì¡´ì˜ ë°©ì‹ëŒ€ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë‹ˆ ì€í–‰ì› 3ëª…ì´ ì—…ë¬´ë¥¼ ë³´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼**, ì€í–‰ì› 1ëª…ì´ ì—…ë¬´ë¥¼ ëë‚ ë•Œê¹Œì§€ ëª¨ë‘ê°€ ê¸°ë‹¤ë¦¬ê³ . 
ì€í–‰ì› 1ì˜ ì—…ë¬´ê°€ ëë‚˜ì„œ ëŒì•„ì˜¤ë©´, ë˜ ë‹¤ì‹œ ì€í–‰ì› 1ì´ ì—…ë¬´ë¥¼ ë³´ê²Œ ë˜ëŠ” ìƒí™©ì´ ìƒê²¼ìŠµë‹ˆë‹¤.  
í•´ë‹¹ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. (ì²˜ìŒì— êµ¬í˜„í–ˆë˜ ë°©ì‹ì„ ì œê°€ ë‹¤ì‹œ ì¶”ì¸¡, ê°„ì†Œí™”í•´ì„œ ì‘ì„±í•œ ê²ƒì´ë¼ ì¡°ê¸ˆ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!)
```swift

import Foundation

class Teller {
    var windowNumber: Int
    var isWorking = false
    
    init(windowNumber: Int) {
        self.windowNumber = windowNumber
    }
    
    func doBusiness(for client: Int) {
        isWorking = true
        print("\(windowNumber)ë²ˆ ì€í–‰ì›ì´ \(client)ë²ˆ ê³ ê°ì„ ìœ„í•´ ì—…ë¬´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.")
        Thread.sleep(forTimeInterval: 3)
        print("\(windowNumber)ë²ˆ ì€í–‰ì›ì´ \(client)ë²ˆ ê³ ê°ì˜ ì—…ë¬´ë¥¼ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤.")
        isWorking = false
    }
}

func makeTellerList(tellerCount: Int) -> [Teller] {
    var tellers = [Teller]()
    
    for i in 1...tellerCount {
        tellers.append(Teller(windowNumber: i))
    }
    return tellers
}

func bankBusiness(clientCount: Int) {
    let tellers = makeTellerList(tellerCount: 3)
    
    var client = 1
    while client <= clientCount {
        for teller in tellers {
            if teller.isWorking == false {
                teller.doBusiness(for: client)
                client += 1
                break
            }
        }
    }
}

bankBusiness(clientCount: 10)
```

ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´, ì•„ë˜ì™€ ê°™ì´ ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤.ğŸ˜‚

<img width="250" src="https://user-images.githubusercontent.com/49546979/118225297-d3cb4780-b4bf-11eb-99bc-6fe32db67c54.gif">

ì™œ ì´ë ‡ê²Œ ë™ì‘í•˜ëŠ”ê±¸ê¹Œìš”?

ë³´í†µ í”„ë¡œê·¸ë˜ë°ì—ì„œ ì½”ë“œì˜ ì‹¤í–‰ì€ ì‘ì„±ëœ ì½”ë“œì˜ ìœ„ì—ì„œ ë¶€í„° ì•„ë˜ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.
ì´ì²˜ëŸ¼ ì½”ë“œê°€ ìœ„ì—ì„œë¶€í„° ì•„ë˜ë¡œ ë‚´ë ¤ì˜¤ë©° í•˜ë‚˜ê°€ ëë‚˜ë©´ ë‹¤ìŒ ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” ë°©ì‹ì„ `ë™ê¸°ì  ì²˜ë¦¬(Synchronous)`ë¼ê³  í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ, ì´ë ‡ê²Œ í•˜ë‚˜ì˜ ì½”ë“œê°€ ëë‚˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ë©´ ì€í–‰ì›ë“¤ì€ 3ëª…ì´ ë™ì‹œì— ì¼ì„ í•  ìˆ˜ ì—†ê²Œë©ë‹ˆë‹¤!
ê·¸ë˜ì„œ ì €ëŠ” ë©”ì¸(ì€í–‰)ì—ì„œ ì—…ë¬´ë¥¼ ë¶„ë‹´í•´ì£¼ë©´, ë°±ê·¸ë¼ìš´ë“œ(ì€í–‰ì›ë“¤)ì—ì„œ ì—…ë¬´ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ `ë¹„ë™ê¸°ì  ì²˜ë¦¬(Asynchronous)`ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. 

### ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ í•˜ê¸°ìœ„í•´ ë¬´ì—‡ì„ ì‚¬ìš©í•´ì•¼í• ê¹Œ

ì´ì— ëŒ€í•´ì„œ êµ¬ê¸€ë§ì„ í•´ë³¸ ê²°ê³¼ `NSThread`, `GCD`, `OperationQueue`ì˜ 3ê°€ì§€ ë°©ë²•ì„ ì°¾ì•„ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

`NSThread`ëŠ” ë©€í‹°ìŠ¤ë ˆë“œ í”„ë¡œê·¸ë˜ë°ì„ ìœ„í•´ ì• í”Œì—ì„œ ì œê³µí•˜ëŠ” ìŠ¤ë ˆë“œ í´ë˜ìŠ¤ë¡œ, ìŠ¤ë ˆë“œì— ëŒ€í•œ ì§ì ‘ ì œì–´ë¥¼ ì›í•˜ê±°ë‚˜ í•„ìš”ë¡œ í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ë°©ì‹ì´ ë³µì¡í•˜ê¸°ë•Œë¬¸ì— ì´ë¥¼ ëŒ€ì²´í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì•„ë˜ ë‘ ë°©ë²•ì´ ë‚˜ì™”ë‹¤ê³  í•©ë‹ˆë‹¤.

`GCD(Grand Central Dispatch)`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìŠ¤ë ˆë“œ í’€ì˜ ê´€ë¦¬ë¥¼ í”„ë¡œê·¸ë˜ë¨¸ê°€ ì•„ë‹Œ ìš´ì˜ì²´ì œì—ì„œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— í”„ë¡œê·¸ë˜ë¨¸ê°€ ì‘ì—…ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œê·¸ë˜ë¨¸ê°€ ì‘ì—…ì„ ìƒì„±í•˜ê³  Dispatch Queueì— ì¶”ê°€í•˜ë©´ GCDëŠ” ì‘ì—…ì— ë§ëŠ” ìŠ¤ë ˆë“œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì„œ ì‹¤í–‰í•˜ê³  ì‘ì—…ì´ ì¢…ë£Œë˜ë©´ ìŠ¤ë ˆë“œë¥¼ ì œê±°í•©ë‹ˆë‹¤. ë©€í‹° ì½”ì–´ì™€ ë©€í‹° í”„ë¡œì„¸ì‹± í™˜ê²½ì—ì„œ ìµœì í™”ëœ í”„ë¡œê·¸ë˜ë°ì„ í•  ìˆ˜ ìˆë„ë¡ ì• í”Œì´ ê°œë°œí•œ ê¸°ìˆ ì…ë‹ˆë‹¤.

`Operation Queue`ëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼í•˜ëŠ” ì‘ì—…ì„ ê°ì²´ ì§€í–¥ì ì¸ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. GCDë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ê³ ìˆìœ¼ë©°, ë™ì‹œì— ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” Operationì˜ ìµœëŒ€ ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆê³ , Operationë¥¼ ì¼ì‹œ ì •ì§€, ë‹¤ì‹œ ì‹œì‘ ë° ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ KVOë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë§ì€ í”„ë¡œí¼í‹°ë“¤ì´ ìˆìŠµë‹ˆë‹¤.

GCDëŠ” Operation Queueì²˜ëŸ¼ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, í˜„ì¬ ìŠ¤í™ìƒìœ¼ë¡œëŠ” ì‘ì—…ì„ ì·¨ì†Œí•˜ëŠ” ë“±ì˜ ê¸°ëŠ¥ì´ í•„ìš”í•˜ì§€ ì•Šì•„ GCDë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ ê²°ì •í•˜ì˜€ìŠµë‹ˆë‹¤.

### ì–´ë–¤ queueë¥¼ ì‚¬ìš©í• ê¹Œ

GCDì—ëŠ” main queueì™€ global queue, custom queueê°€ ìˆìŠµë‹ˆë‹¤.  
ì´ ì¤‘ì—ì„œë„ mainì€ UIì‘ì—…ì„ ë‹´ë‹¹í•˜ëŠ” íì´ê¸° ë•Œë¬¸ì—, ì€í–‰ì›ì˜ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•˜ë©´ì„œ ë©ˆì¶”ëŠ” ê²ƒ(sleep)ì€ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë™ì‘ì´ë¼ ìƒê°í•˜ì—¬ ì œì™¸í•˜ì˜€ìŠµë‹ˆë‹¤.

**ì²˜ìŒì—ëŠ” ì•„ë˜ì²˜ëŸ¼ global queueë¡œ ì‘ì—…ì„ í–ˆìŠµë‹ˆë‹¤.**

```swift
class Teller {
    var windowNumber: Int
    var isWorking = false
    
    init(windowNumber: Int) {
        self.windowNumber = windowNumber
    }
    
    func doBusiness(for client: Int) {
        isWorking = true
        DispatchQueue.global().async {
            print("\(self.windowNumber)ë²ˆ ì€í–‰ì›ì´ \(client)ë²ˆ ê³ ê°ì„ ìœ„í•´ ì—…ë¬´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.")
            Thread.sleep(forTimeInterval: 1)
            print("\(self.windowNumber)ë²ˆ ì€í–‰ì›ì´ \(client)ë²ˆ ê³ ê°ì˜ ì—…ë¬´ë¥¼ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤.")
            self.isWorking = false
        }
    }
}

func makeTellers(tellerCount: Int) { ... }

func bankBusiness(clientCount: Int) {
    let tellers = makeTellerList(tellerCount: 3)
    var currentClientNumber = 1
    
    var isContinue = true
    while isContinue {
        for teller in tellers {
            if currentClientNumber > clientCount {
                isContinue = false
                break
            }
            if teller.isWorking == false {
                teller.doBusiness(for: currentClientNumber)
                currentClientNumber += 1
            }
        }
    }
}
```
tellers ë°°ì—´ì—ì„œ ì¼í•˜ì§€ ì•Šê³  ìˆëŠ” tellerê°€ ìˆìœ¼ë©´, ì†ë‹˜ì„ í• ë‹¹ë°›ê³  global íì—ì„œ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.  
ì´ë•Œ, global queueëŠ” Concurrentí•œ í ì´ê¸°ë•Œë¬¸ì—, í•´ë‹¹ í ë‚´ë¶€ì—ì„œ ìŠ¤ë ˆë“œë¥¼ ê°ê° í• ë‹¹ë°›ì•„ 3ëª…ì´ ë™ì‹œì— ì—…ë¬´ë¥¼ ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.  
ê·¸ëŸ¼ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ whileë¬¸ì„ ê³„ì† ëŒë©´ì„œ ë¹„ì–´ìˆëŠ” ì€í–‰ì›ì—ê²Œ ì¼ì„ í• ë‹¹í•´ì£¼ê¸°ë•Œë¬¸ì—, í•œì¤„ì„œê¸° ê°™ì€ ëª¨ìŠµì´ ë©ë‹ˆë‹¤.  
ì´ì™€ ê°™ì€ ê²½ìš° í”Œë ˆì´ê·¸ë¼ìš´ë“œì—ì„œ í…ŒìŠ¤í–ˆì„ ë•Œ whlieë¬¸ì´ ì•½ 1,100,000íšŒ ì •ë„ í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— `ê³¼ì—° ì¢‹ì€ ë™ì‘ì¸ê°€?`í•˜ëŠ” ì˜ì‹¬ì„ í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.  

<img width="600" src="https://user-images.githubusercontent.com/49546979/118354436-05b6d980-b5a6-11eb-9321-d2aa02d5a389.png">


**ê·¸ë˜ì„œ ë‘ë²ˆì§¸ë¡œ custom queueë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì‘ì‹œì¼œë³´ì•˜ìŠµë‹ˆë‹¤.**

```swift 

import Foundation

class Teller {
    var windowNumber: Int
    var workingQueue: DispatchQueue
    
    init(windowNumber: Int) {
        self.windowNumber = windowNumber
        self.workingQueue = DispatchQueue(label: "\(windowNumber)")
    }
    
    func doBusiness(for client: Int) {
        workingQueue.async {
            print("\(self.windowNumber)ë²ˆ ì€í–‰ì›ì´ \(client)ë²ˆ ê³ ê°ì„ ìœ„í•´ ì—…ë¬´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.")
            Thread.sleep(forTimeInterval: 1)
            print("\(self.windowNumber)ë²ˆ ì€í–‰ì›ì´ \(client)ë²ˆ ê³ ê°ì˜ ì—…ë¬´ë¥¼ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤.")
        }
    }
}

func makeTellerList(tellerCount: Int) -> [Teller] { ... }

func bankBusiness(clientCount: Int) {
    let tellers = makeTellerList(tellerCount: 3)
    var currentClientNumber = 1
    
    var isContinue = true
    while isContinue {
        counter += 1
        for teller in tellers {
            if currentClientNumber > clientCount {
                isContinue = false
                break
            }
            teller.doBusiness(for: currentClientNumber)
            currentClientNumber += 1
        }
    }
}

bankBusiness(clientCount: 10)
```
ìœ„ì˜ ê²½ìš°ëŠ” tellerê°€ ì¼ì„ í•˜ê³  ìˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³ , ìš°ì„  ê³ ê°ë“¤ì„ ë‚˜ëˆ„ì–´ì£¼ê³   
custom queueê°€ serial í•˜ê²Œ ë™ì‘í•˜ê¸°ë•Œë¬¸ì—, ì€í–‰ì›ì˜ í ë‚´ë¶€ì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ ì¼ì„ ì²˜ë¦¬í•´ì£¼ê²Œ ë©ë‹ˆë‹¤.  
ì´ë ‡ê²Œ ë™ì‘í•˜ëŠ” ê²½ìš°ëŠ” ì†ë‹˜ë“¤ì´ í•œì¤„ì„œê¸°ê°€ ì•„ë‹ˆë¼, ê°ê° íì— ì¤„ì„ ì„œê¸° ë•Œë¬¸ì— whileë¬¸ì€ 4ë²ˆë§Œ ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤.  

<img width="600" src="https://user-images.githubusercontent.com/49546979/118354837-f9cc1700-b5a7-11eb-80d1-cdb6623acea0.png">

ê·¸ë˜ì„œ ì–´ë–¤ê±¸ ì‚¬ìš©í•´ì•¼í• ê¹Œìš”?  
ë§Œì•½ ì§€ê¸ˆì²˜ëŸ¼ ì—…ë¬´ ì‹œê°„ì´ ëª¨ë‘ ë™ì¼í•˜ë©´ ì»¤ìŠ¤í…€ íì— ë¯¸ë¦¬ ëŒ€ê¸°í•´ë„, ì‹œê°„ì´ í¬ê²Œ ì°¨ì´ê°€ ë‚˜ì§€ ì•Šì•„ì„œ ìƒê´€ì´ ì—†ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.  
í•˜ì§€ë§Œ, ë’¤ìª½ì—ì„œëŠ” ì¼ë°˜ì—…ë¬´ì™€ ëŒ€ì¶œì—…ë¬´ 2ê°€ì§€ë¡œ ë‚˜ëˆ„ì–´ì§€ê³ , ì‹œê°„ë„ ë§ì´ ë‹¬ë¼ì§€ê¸°ë•Œë¬¸ì— global queueë¥¼ ì‚¬ìš©í•˜ì—¬ í•œì¤„ì„œê¸°ë¡œ ì§„í–‰í•˜ëŠ” ê²ƒì´ ë” ë§ëŠ” ë™ì‘ë°©ì‹ì´ë¼ ìƒê°ë˜ì–´ global queueë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.  

## ì°¸ê³  ì£¼ì†Œ

- ğŸ›  [original repository](https://github.com/jryoun1/ios-bank-manager/tree/step3-lina-develop)

- ğŸ“ [Pull Request && Review](https://github.com/yagom-academy/ios-bank-manager/pulls)
  - [ì²«ë²ˆì§¸ PR](https://github.com/yagom-academy/ios-bank-manager/pull/4)
  - [ë‘ë²ˆì§¸ PR](https://github.com/yagom-academy/ios-bank-manager/pull/15)
  - [ì„¸ë²ˆì§¸ PR](https://github.com/yagom-academy/ios-bank-manager/pull/19)


